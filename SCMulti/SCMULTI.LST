Z80ASM SuperFast Relocating Macro Assembler     	    Z80ASM 1.32 Page   1
SCMULTI Z80

    1                   ; SOUTHERN CROSS MULTI FUNCTION PROGRAM
    2                   ; FOR LED OUTPUTS ON PORT $80
    3                   ; USING SCNEO ROM
    4                   ; FOR EDUCATIONAL USES ONLY -- TEACHING BINARY
    5                   ; VERSION 1.0
    6                   ; ASSEMBLED WITH Z80ASM (SLR SYSTEMS)
    7                   ; SWITCHES SELECT DIFFERENT OPTIONS
    8                   ; 0 (VAL1) -- PORT REFLECTOR -- DISPLAY SWITCH STATUS
    9                   ; 1 (VAL2) -- BINARY COUNTER
   10                   ;		SWITCH 6 PAUSES COUNTER
   11                   ;		SWITCH 7 RESETS COUNTER (OR SHUT OFF SWITCH 1)
   12                   ; 2 (VAL4) -- BACK AND FORTH (CYLON)
   13                   ; 3 (VAL8) -- SIMPLE COUNTER
   14                   ;		SWITCH 7 COUNTS -- SHUT OFF SWITCH 3 TO RESET
   15                   ; 4 (VAL16) -- EXIT (CALL 28H)
   16                   ; GNU GPL LICENSE V3
   17                   
   18                   ; -- RICKY BRYCE
   19                   
   20                   ; ** BEGIN PROGRAM HEADER -- DECLARATIONS **
   21         0009      BINCTDLYH:	EQU 09H		; HIGH BYTE OF TIMER DELAY
   22         0085      BINCTDLYL:	EQU 85H		; LOW BYTE OF TIMER DELAY
   23         0001      BINCTDLYF:	EQU 01H		; FINE TUNE FOR TIMER DELAY
   24         0000      CYLONDLYH:	EQU 00H		; HIGH BYTE OF CYLON DELAY
   25         0081      CYLONDLYL:	EQU 81H		; LOW BYTE OF CYLON DELAY
   26         0001      CYLONDLYF:	EQU 01H		; FINE TUNE FOR CYLON DELAY
   27         0001      INNERDLY:	EQU 01H		; INNER DELAY LOOP (VERY COARSE)
   28         0080      OUTPORT:	EQU 80H		; PORT FOR LEDS ON I/O MODULE
   29         0081      INPORT:		EQU 81H		; PORT FOR SWITCHES ON I/O MODULE
   30                   ; ** END PROGRAM HEADER -- DECLARATIONS **
   31                   
   32         2000      	ORG 2000H ; SOUTHERN CROSS PROGRAMS START AT 2000H
   33                   
   34                   ; ** BEGIN INITIALIZE **
   35 2000              INIT:
   36 2000  3E 00       	LD A,00H	; LOAD 0 TO ACCUMULATOR
   37 2002  21 0000     	LD HL,00H	; CLEAR HL REGISTER
   38 2005  32 2159     	LD (MODE),A	; START WITH A CLEAR MODE
   39 2008  32 2158     	LD (COUNTER),A	; START COUNTER AT ZERO
   40 200B  32 215B     	LD (CTRONS),A	; START COUNTER ONE SHOT AT 0
   41 200E  3E 00       	LD A,00H	; TURN ALL BITS OFF IN A
   42 2010  D3 80       	OUT (OUTPORT),A	; SHUT OFF ALL LIGHTS (1=OFF)
   43                   ; ** END INITIALIZE **
   44                   
   45                   ; ** BEGIN MAIN ROUTINE **
   46 2012              MAIN:
   47 2012  CD 2136     	CALL MODESET
   48                   
   49 2015  3A 2159     	LD A,(MODE)	; CHK MODE ZERO (NO MODE)
   50 2018  B7          	OR A
   51 2019  28 F7       	JR Z,MAIN
   52                   
   53 201B  3A 2159     	LD A,(MODE)	; CHK MODE 1 (PORT REFLECTOR)
   54 201E  FE 01       	CP 1
   55 2020  CA 2045     	JP Z,PORTREF
   56                   
   57 2023  3A 2159     	LD A,(MODE)	; CHK MODE 2 (BINARY COUNTER)
   58 2026  FE 02       	CP 2
Z80ASM SuperFast Relocating Macro Assembler     	    Z80ASM 1.32 Page   2
SCMULTI Z80

   59 2028  CA 2051     	JP Z,BINCT
   60                   
   61 202B  3A 2159     	LD A,(MODE)	; CHK MODE 4 (CYLON)
   62 202E  FE 04       	CP 4
   63 2030  CA 208C     	JP Z,CYLON
   64                   
   65 2033  3A 2159     	LD A,(MODE)	; CHK MODE 8 (SIMPLE COUNTER)
   66 2036  FE 08       	CP 8
   67 2038  CA 20EE     	JP Z,SCOUNTER
   68                   
   69 203B  3A 2159     	LD A,(MODE)	; CHK MODE 16D 10H (EXIT TO CPM)
   70 203E  FE 10       	CP 10H
   71 2040  CA 0000     	JP Z,00H	; EXIT TO CPM
   72                   
   73 2043  18 CD       	JR MAIN		; INVALID MODE 
   74                   
   75                   ; ** END MAIN ROUTINE **
   76                   
   77                   ; ** BEGIN PORT REFLECTOR ROUTINE **
   78 2045              PORTREF:
   79 2045  DB 81       	IN A,(INPORT)	; GET THE SWITCHES
   80                   	;XOR 0FFH	; REVERSE THE VALUE
   81 2047  D3 80       	OUT (OUTPORT),A	; SEND THEM TO THE LIGHTS
   82 2049  DB 81       	IN A,(INPORT)	; GET THE SWITCHES AGAIN
   83 204B  B7          	OR A		; CHECK IF ZERO
   84 204C  20 F7       	JR NZ,PORTREF	; IF NOT ZERO, STAY IN ROUTINE
   85 204E  C3 2012     	JP MAIN		; OTHERWISE, GO BACK TO MAIN 
   86                   ; ** END PORT REFLECTOR ROUTINE **
   87                   
   88                   ; ** BEGIN BINARY COUNTER ROUTINE **
   89 2051              BINCT:
   90 2051  3E 00       	LD A,00H	; LD ZERO TO ACCUMULATOR
   91 2053  32 2158     	LD (COUNTER),A	; START COUNTER AT ZERO
   92 2056              RNBCTR:
   93 2056  3A 2158     	LD A,(COUNTER)	; LOAD THE COUNTER VALUE TO A
   94                   	;XOR 0FFH	; REVERSE ALL BITS
   95 2059  D3 80       	OUT (OUTPORT),A	; SEND VALUE TO LEDS
   96 205B  3A 2158     	LD A,(COUNTER)	; LOAD A FROM COUNTER MEMORY
   97 205E  3C          	INC A		; INCREMENT ACCUMULATOR
   98 205F  32 2158     	LD (COUNTER),A	; STORE NEXT VALUE TO COUNTER
   99                   
  100 2062  26 09       	LD H,BINCTDLYH	; LOAD HIGH BYTE TO H
  101 2064  2E 85       	LD L,BINCTDLYL	; LOAD LOW BYTE TO L
  102 2066  0E 01       	LD C,BINCTDLYF	; LOAD FINE TUNE BYTE TO C
  103 2068  CD 2123     	CALL DELAY	; CALL THE DELAY LOOP
  104                   
  105 206B  DB 81       	IN A,(INPORT)	; CHECK THE SWITCHES
  106 206D  B7          	OR A		; CHECK A FOR ZERO
  107 206E  20 0C       	JR NZ,SW7	; IF NOT ZERO, THEN CHECK THE VALUES
  108                   
  109 2070  3E 00       	LD A,00H	; LOAD ZERO TO A
  110 2072  D3 80       	OUT (OUTPORT),A	; ZERO THE DISPLAY
  111 2074  3E 00       	LD A,00H	; LOAD A WITH ZERO
  112 2076  32 2158     	LD (COUNTER),A	; CLEAR THE COUNTER -- CLEAN UP
  113 2079  C3 2012     	JP MAIN		; EXIT TO MAIN ROUTINE
  114 207C              SW7:
  115 207C  DB 81       	IN A,(INPORT)	; RELOAD A WITH SWITCH VALUES
  116 207E  E6 80       	AND A,80H	; CHECK TO SEE IF SWITCH 7 IS ON
Z80ASM SuperFast Relocating Macro Assembler     	    Z80ASM 1.32 Page   3
SCMULTI Z80

  117 2080  C2 2051     	JP NZ,BINCT	; IF SO, THEN RESET THE COUNTER
  118 2083              SW6:
  119 2083  DB 81       	IN A,(INPORT)	; RELOAD A WITH SWITCHES
  120 2085  E6 40       	AND 40H		; CHECK TO SEE IF SWITCH 6 IS ON
  121 2087  20 FA       	JR NZ,SW6	; HOLD HERE (PAUSE BINARY COUNTER)
  122                   
  123 2089  C3 2056     	JP RNBCTR	; KEEP RUNNING
  124                   ; ** END BINARY COUNTER ROUTINE **
  125                   
  126                   ; ** BEGIN CYLON ROUTINE **
  127 208C              CYLON:
  128 208C  26 00       	LD H,CYLONDLYH	; LOAD HIGH BYTE OF TIMER
  129 208E  2E 81       	LD L,CYLONDLYL	; LOAD LOW BYTE OF TIMER
  130 2090  0E 01       	LD C,CYLONDLYF	; LOAD CYLON DELAY FINE
  131 2092  3E 01       	LD A,01H	; LOAD A WITH $01
  132 2094  32 2158     	LD (COUNTER),A	; LOAD COUNTER VALUE WITH $01
  133                   	;XOR 0FFH	; REVERSE ALL LIGHTS
  134 2097  D3 80       	OUT (OUTPORT),A	; TURN ON LIGHT #0
  135 2099  CD 2123     	CALL DELAY	; CALL THE DELAY LOOP
  136 209C              CYLFT:
  137 209C  DB 81       	IN A,(INPORT)	; GET THE SWITCHES
  138 209E  B7          	OR A		; SEE IF ALL SWITCHES ARE OFF
  139 209F  C2 20AA     	JP NZ,CYLFT1	; IF SO, GO BACK TO MAIN
  140 20A2  3E 00       	LD A,00H	; OTHERWISE START CLEANUP -- LOAD 0 TO A
  141 20A4  32 2158     	LD (COUNTER),A	; RESET THE COUNTER
  142 20A7  C3 2012     	JP MAIN		; BACK TO MAIN
  143 20AA              CYLFT1:
  144 20AA  3A 2158     	LD A,(COUNTER)	; RELOAD A WITH COUNTER
  145 20AD  17          	RLA		; ROTATE LEFT
  146 20AE  32 2158     	LD (COUNTER),A	; STORE A TO COUNTER MEMORY
  147                   	;XOR 0FFH	; FLIP ALL BITS
  148 20B1  D3 80       	OUT (OUTPORT),A	; SEND COUNTER TO LEDS
  149                   
  150 20B3  26 00       	LD H,CYLONDLYH	; LOAD HIGH BYTE OF CYLONDELAY
  151 20B5  2E 81       	LD L,CYLONDLYL	; LOAD LOW BYTE OF CYLONDELAY
  152 20B7  0E 01       	LD C,CYLONDLYF	; LOAD CYLON DELAY FINE
  153 20B9  CD 2123     	CALL DELAY	; CALL THE DELAY ROUTINE
  154 20BC  3A 2158     	LD A,(COUNTER)	; RELOAD A FROM COUNTER
  155 20BF  FE 80       	CP 80H		; CHECK TO SEE IF IT'S 80H
  156 20C1  28 02       	JR Z,CYRGT	; IF 80H START ROTATING RIGHT
  157 20C3  18 D7       	JR CYLFT
  158 20C5              CYRGT:
  159 20C5  DB 81       	IN A,(INPORT)	; GET THE SWITCHES
  160 20C7  B7          	OR A		; SEE IF THEY ARE ALL OFF
  161 20C8  C2 20D3     	JP NZ,CYRGT1	; CONTINUE IF A SWITCH IS ON
  162 20CB  3E 00       	LD A,00H	; OTHERWISE CLEANUP -- LOAD 0 TO A
  163 20CD  32 2158     	LD (COUNTER),A	; RESET COUNTER TO ZERO
  164 20D0  C3 2012     	JP MAIN		; BACK TO MAIN
  165 20D3              CYRGT1:
  166 20D3  3A 2158     	LD A,(COUNTER)	; LOAD A FROM COUNTER
  167 20D6  1F          	RRA		; ROTATE RIGHT
  168 20D7  32 2158     	LD (COUNTER),A	; LOAD COUNTER FROM A
  169                   	;XOR 0FFH	; REVERSE BITS
  170 20DA  D3 80       	OUT (OUTPORT),A	; SEND TO THE LEDS
  171 20DC  26 00       	LD H,CYLONDLYH	; LOAD HIGH BYTE OF DELAY
  172 20DE  2E 81       	LD L,CYLONDLYL	; LOAD LOW BYTE OF DELAY
  173 20E0  0E 01       	LD C,CYLONDLYF	; LOAD FINE DELAY
  174 20E2  CD 2123     	CALL DELAY	; CALL THE DELAY LOOP
Z80ASM SuperFast Relocating Macro Assembler     	    Z80ASM 1.32 Page   4
SCMULTI Z80

  175 20E5  3A 2158     	LD A,(COUNTER)	; RELOAD A FROM COUNTER
  176 20E8  FE 01       	CP 1		; COMPARE WITH 1
  177 20EA  28 B0       	JR Z,CYLFT	; IF SO, THEN ROTATE LEFT
  178 20EC  18 D7       	JR CYRGT	; IF NOT, KEEP ROTATING RIGHT
  179                   ; ** END CYLON ROUTINE **
  180                   
  181                   ; ** BEGIN SIMPLE COUNTER ROUTINE **
  182 20EE              SCOUNTER:		; SIMPLE COUNTER
  183 20EE  DB 81       	IN A,(INPORT)	; LOAD A WITH SWITCHES
  184 20F0  B7          	OR A		; CHECK IF ZERO
  185 20F1  C2 20FC     	JP NZ,SCOUNTER1	; IF NOT, CONTINUE
  186 20F4  3E 00       	LD A,00H	; LOAD 0 TO A FOR CLEANUP
  187 20F6  32 2158     	LD (COUNTER),A	; SET COUNTER TO ZERO
  188 20F9  C3 2012     	JP MAIN		; GO BACK TO MAIN
  189                   
  190 20FC              SCOUNTER1:
  191 20FC  DB 81       	IN A,(INPORT)	; LOAD A WITH SWITCHES
  192 20FE  E6 80       	AND 80H		; CHECK FOR SWITCH 7
  193 2100  20 07       	JR NZ,CHKONS	; IF NOT, THEN LOOP AND WAIT
  194 2102  3E 00       	LD A,0		; LOAD ZERO TO ACCUMULATOR
  195 2104  32 215B     	LD (CTRONS),A	; CLEAR ONE SHOT
  196 2107  18 E5       	JR SCOUNTER	
  197 2109              CHKONS:	
  198 2109  3A 215B     	LD A,(CTRONS)	; LOAD ONE SHOT TO A
  199 210C  B7          	OR A		; CHECK IF ZERO
  200 210D  28 03       	JR Z,RNSCTR	; IF ZERO, THEN OK TO ADD 1
  201 210F  C3 20EE     	JP SCOUNTER	; START OVER
  202                    
  203 2112              RNSCTR:
  204 2112  3E 01       	LD A,1		; LOAD VALUE OF 1 TO A
  205 2114  32 215B     	LD (CTRONS),A	; SET ONESHOT BIT
  206 2117  3A 2158     	LD A,(COUNTER)	; LOAD A WITH COUNTER
  207 211A  3C          	INC A		; INCREMENT A
  208 211B  32 2158     	LD (COUNTER),A	; STORE INCREMENTED VALUE
  209                   	;XOR 0FFH	; REVERSE ALL BITS
  210 211E  D3 80       	OUT (OUTPORT),A	; SEND COUNTER TO LEDS
  211 2120  C3 20EE     	JP SCOUNTER	; BACK TO SCOUNTER LABEL
  212                   ; ** END SIMPLE COUNTER ROUTINE **
  213                   
  214                   ; ** BEGIN DELAY SUBROUTINE **
  215                   ; USE THE CALL FUNCTION TO CALL DELAY
  216                   ; ENTRY: HL WILL BE THE COARSE DELAY
  217                   ;	 C WILL BE THE FINE DELAY
  218                   ; EXIT: RETURNS ZERO ON HL
  219                   ;	RETURNS ZERO ON C
  220 2123              DELAY:
  221 2123  06 01       	LD B,INNERDLY	; LOAD B WITH 30H FOR INTERNAL LOOP
  222 2125              DELAY1:
  223 2125  7C          	LD A,H		; LOAD A FROM H
  224 2126  B5          	OR L		; OR L WITH H (NOW A)
  225 2127  28 05       	JR Z,DLYFINE	; IF ALL BITS ARE CLEARED, RETURN
  226 2129  2B          	DEC HL		; DECREMENT HL REGISTER
  227 212A              DELAY2:
  228 212A  10 FE       	DJNZ DELAY2	; DEC B AND JUMP UNTIL B=0
  229                   
  230 212C  18 F7       	JR DELAY1	; HL WASN'T ZERO, RE-EXECUTE
  231                   
  232 212E              DLYFINE:
Z80ASM SuperFast Relocating Macro Assembler     	    Z80ASM 1.32 Page   5
SCMULTI Z80

  233 212E  79          	LD A,C
  234 212F  B7          	OR A
  235 2130  28 03       	JR Z,DLYRET
  236 2132  0D          	DEC C
  237 2133  18 F9       	JR DLYFINE
  238 2135              DLYRET:
  239                   			; YOU CAN ADD NOPS HERE FOR MORE FINE TUNING
  240 2135  C9          	RET		; RETURN FROM SUBROUTINE
  241                   ; ** END DELAY SUBROUTINE **
  242                   
  243                   ; ** BEGIN MODE ROUTINE **
  244 2136              MODESET:		;DETECT MODE CHANGE
  245 2136  DB 81       	IN A,(INPORT)	; GET SWITCHES
  246 2138  B7          	OR A		; SEE IF THEY ARE OFF
  247 2139  28 0D       	JR Z,SWOFF	; IF SO, SET THE MODE TO 0
  248                   
  249 213B  3A 2159     	LD A,(MODE)	; LOAD MODE TO A
  250 213E  B7          	OR A		; SEE IF IT'S ZERO
  251 213F  20 16       	JR NZ,MODERET   ; IF NOT, THEN RETURN
  252                   	
  253 2141  DB 81       	IN A,(INPORT)	; LOAD A WITH SWITCHES
  254 2143  32 2159     	LD (MODE),A	; SET THE MODE IN MEMORY
  255 2146  18 0F       	JR MODERET	; RETURN	
  256                   
  257 2148              SWOFF:
  258 2148  3E 00       	LD A,00H	; LOAD 0 TO ACCUMULATOR
  259 214A  32 2158     	LD (COUNTER),A	; ZERO COUNTER
  260 214D  32 2159     	LD (MODE),A	; SET MODE TO ZERO
  261 2150  32 215B     	LD (CTRONS),A	; CLEAR ONESHOT
  262 2153  3E 00       	LD A,00H	; LOAD A WITH ALL BITS LOW
  263 2155  D3 80       	OUT (OUTPORT),A	; SHUT ALL LIGHTS OFF
  264 2157              MODERET:
  265 2157  C9          	RET
  266                   ; ** END MODE ROUTINE **
  267                   
  268                   
  269                   ; ** BEGIN FOOTER -- MEMORY STORAGE **
  270 2158              COUNTER:
  271 2158  00          	DB 00H
  272 2159              MODE:
  273 2159  00          	DB 00H
  274 215A              MODECLR:
  275 215A  00          	DB 00H
  276 215B              CTRONS:
  277 215B  00          	DB 00H
  278                   ; ** END FOOTER -- MEMORY STORAGE **
  279                   	END
 0 Error(s) Detected.
 348 Absolute Bytes. 37 Symbols Detected.
       SWOFF:
  258 2148  3E 00       	LD A,00H	; LOAD 0 TO ACCUMULATOR
  259 214A  32 2158     	